<div class="container-fluid">
  <div class="row m-t-25">
    <div class="col-12">

      <!-- Filtres et actions -->
      <div class="filter-section">
        <div class="row">
          <!-- Recherche -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Rechercher une dette...</mat-label>
              <input matInput
                     placeholder="Rechercher par intitulé, montant, utilisateur..."
                     (keyup)="applyFilter($event.target.value)"
                     [value]="searchText">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div>

          <!-- Actions -->
          <div class="col-md-6">
            <div class="action-buttons">
              <button mat-stroked-button (click)="resetFilters()" class="reset-button">
                <i class="ti ti-refresh m-r-8"></i>
                Réinitialiser
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Carte principale -->
      <app-card cardTitle="Liste des Dettes" cardClass="debts-card" padding="0">
        <div class="table-responsive">
          <!-- Chargement -->
          <div *ngIf="isLoading" class="loading-spinner text-center p-5">
            <i class="ti ti-loader-2 spinner-icon"></i>
            <p class="loading-text">Chargement des dettes...</p>
          </div>

          <!-- Tableau -->
          <table mat-table [dataSource]="filteredDataSource" class="debts-table" *ngIf="!isLoading">

            <!-- Intitulé Column -->
            <ng-container matColumnDef="intitule">
              <th mat-header-cell *matHeaderCellDef>
                <i class="ti ti-file-text m-r-8"></i>
                Intitulé
              </th>
              <td mat-cell *matCellDef="let debt" class="intitule-cell">
                <div class="debt-title">
                  <i class="ti ti-report-money debt-icon"></i>
                  <div>
                    <div class="f-w-600">{{ debt.intitule }}</div>
                    <div class="debt-id">ID: {{ debt.id }}</div>
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Montant Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef class="text-right">
                <i class="ti ti-currency-franc m-r-8"></i>
                Montant
              </th>
              <td mat-cell *matCellDef="let debt" class="text-right">
                <span class="amount-badge" [style.background]="getAmountColor(debt.amount)">
                  {{ formatAmount(debt.amount) }}
                </span>
              </td>
            </ng-container>

            <!-- User ID Column -->
            <ng-container matColumnDef="userId">
              <th mat-header-cell *matHeaderCellDef class="text-center">
                <i class="ti ti-user m-r-8"></i>
                Utilisateur
              </th>
              <td mat-cell *matCellDef="let debt" class="text-center">
                <span class="user-badge">
                  <i class="ti ti-id"></i>
                  {{ debt.user.firstname }} {{ debt.user.lastname }}
                </span>
              </td>
            </ng-container>

            <!-- Card ID Column -->
            <ng-container matColumnDef="cardId">
              <th mat-header-cell *matHeaderCellDef class="text-center">
                <i class="ti ti-credit-card m-r-8"></i>
                Carte
              </th>
              <td mat-cell *matCellDef="let debt" class="text-center">
                <span class="card-badge">
                  <i class="ti ti-credit-card"></i>
                  {{ debt.cardId }}
                </span>
              </td>
            </ng-container>

            <!-- Date de création Column -->
            <ng-container matColumnDef="createdAt">
              <th mat-header-cell *matHeaderCellDef>
                <i class="ti ti-calendar m-r-8"></i>
                Date de création
              </th>
              <td mat-cell *matCellDef="let debt" class="date-cell">
                <div class="date-info">
                  <i class="ti ti-clock"></i>
                  {{ formatDate(debt.createdAt) }}
                </div>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="text-center">
                <i class="ti ti-settings m-r-8"></i>
                Actions
              </th>
              <td mat-cell *matCellDef="let debt" class="text-center">
                <div class="action-buttons">
                  <button mat-icon-button color="primary"
                          (click)="viewDebtDetails(debt)"
                          matTooltip="Voir les détails" class="action-button">
                    <i class="ti ti-eye f-18"></i>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-data-row"></tr>

            <!-- Aucune donnée -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="6">
                <div class="text-center p-5 text-muted no-data">
                  <i class="ti ti-report-money no-data-icon"></i>
                  <p class="no-data-text">
                    {{ searchText ? 'Aucune dette trouvée pour "' + searchText + '"' : 'Aucune dette enregistrée' }}
                  </p>
                  <button mat-stroked-button (click)="resetFilters()" class="m-t-8" *ngIf="searchText">
                    <i class="ti ti-refresh m-r-8"></i>
                    Réinitialiser la recherche
                  </button>
                </div>
              </td>
            </tr>
          </table>

          <!-- Pagination -->
          <mat-paginator [length]="searchText ? filteredDataSource.length : totalItems"
                        [pageSize]="itemsPerPage"
                        [pageSizeOptions]="[5, 10, 25, 50]"
                        [pageIndex]="currentPage - 1"
                        (page)="onPageChange($event)"
                        showFirstLastButtons
                        class="debts-paginator">
          </mat-paginator>
        </div>
      </app-card>

    </div>
  </div>
</div>
